
Template

!
! Generated by NetBox for {{ device.name }} at {{ device.site.name }}
!
hostname {{ device.name }}
!
! VLANs
{% for vlan in  device.site.vlans.all() %}
vlan {{ vlan.vid }}
 name {{ vlan.name }}
!
{% endfor %}
!

! SVI Configuration
{% for interface in device.interfaces.all() if interface.type == 'virtual' and 'Loopback' not in interface.name %}
{% if interface.ip_addresses %}
interface {{ interface.name }}
 description {{ interface.description | default("SVI for " + interface.name) }}
 no shutdown
{% for ip_address in interface.ip_addresses.all() %}
{% if loop.first %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }}
{% else %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }} secondary
{% endif %}
{% endfor %}
!
{% endif %}
{% endfor %}
!
! Loopback Interfaces
{% for interface in device.interfaces.all() if interface.name.startswith('Loopback') %}
interface {{ interface.name }}
 description {{ interface.description | default('Loopback Interface') }}
 {% if interface.ip_addresses %}
 {% for ip_address in interface.ip_addresses.all() %}
 {% if loop.first %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }}
 {% else %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }} secondary
 {% endif %}
 {% endfor %}
 {% endif %}
{% endfor %}
!

! Port-Channel Interfaces (LACP)
{% for interface in device.interfaces.all() if interface.type == 'lag' %}

interface {{ interface.name }}
 description {{ interface.description | default('LAG Interface ' + interface.name) }}
{% if interface.enabled %}
 no shutdown
 {% else %}
 shutdown
 {% endif %}
 {% if interface.count_ipaddresses %}
no switchport
 {% for ip_address in interface.ip_addresses.all() %}
 {% if loop.first %}
ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }}
 {% else %}
ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }} secondary
 {% endif %}
 {% endfor %}
 {% elif interface.mode.value == 'tagged' and interface.tagged_vlans %}
switchport mode trunk
switchport trunk allowed vlan {{ interface.tagged_vlans | map(attribute='vid') | join(',') }}
 {% elif interface.mode.value == 'access' and interface.untagged_vlan %}
switchport mode access
switchport access vlan {{ interface.untagged_vlan.vid }}
{% endif %}
!
{% endfor %}
!

! Physical Interfaces (Port-Channel Members)
{% for interface in device.interfaces.all() %}
{% if interface.lag and interface.type != 'lag' %}
interface {{ interface.name }}
 description {{ interface.description | default('Member of ' + interface.lag.name) }}
 channel-group{{ interface.lag.name| lower| replace('port-channel','') }} mode active
{% endif %}
{% endfor %}

! Physical Interfaces (L2 and L3)
{% for interface in device.interfaces.all() %}
{% if not interface.is_mgmt_only and interface.type != 'virtual' and interface.type != 'lag' and not interface.lag %}

interface {{ interface.name }}
{% if interface.description|length > 0 %}
  description {{ interface.description }}
{%- elif interface.link_peers and interface.link_peers[0]  %} 
 description {{ 'Connected To ' + interface.link_peers[0]['device']['name'] + ':' + interface.link_peers[0]['name']  }}
{% endif %}
{% if interface.enabled %}
 no shutdown
{% else %}
 shutdown
{% endif %}
{% if interface.count_ipaddresses %}
 no switchport
 {% for ip_address in interface.ip_addresses.all() %}
 {% if loop.first %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }}
 {% else %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }} secondary
 {% endif %}
 {% endfor %}
 {% elif interface.mode == 'access' and interface.untagged_vlan %}
 switchport mode access
 switchport access vlan {{ interface.untagged_vlan.vid }}
 {% elif interface.mode == 'tagged' %}
 switchport mode trunk
  {% endif %}
 {%- if interface.mode == 'tagged' and interface.tagged_vlans.count() > 0 -%}
switchport trunk allowed vlan {{ interface.tagged_vlans.all() | map(attribute='vid') | join(',') }}
 {% endif %}
{% endif %}
{% endfor %}
!

!
end

